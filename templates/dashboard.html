
{% extends 'base.html' %}
{% block title %}Dashboard & Analytics{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Dashboard & Analytics</h2>
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Revenue</h5>
                    <p class="card-text display-6">₹{{ total_revenue | round(2) }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger mb-3">
                <div class="card-body">
                    <h5 class="card-title">Outstanding</h5>
                    <p class="card-text display-6">₹{{ total_outstanding | round(2) }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">Bills</h5>
                    <p class="card-text display-6">{{ num_bills }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-body">
                    <h5 class="card-title">Top Center</h5>
                    <p class="card-text display-6">{{ top_center or 'N/A' }}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">Monthly Billing Trend</div>
                <div class="card-body">
                    <canvas id="monthlyTrendChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">Top 5 Centers</div>
                <div class="card-body">
                    <canvas id="topCentersChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">Category Distribution</div>
                <div class="card-body">
                    <canvas id="categoryDistChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">Paid vs Outstanding</div>
                <div class="card-body">
                    <canvas id="paidOutstandingChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Prepare data from Jinja2
const monthlyTrendLabels = {{ monthly_trend | map(attribute=0) | list | tojson | safe }};
const monthlyTrendData = {{ monthly_trend | map(attribute=1) | list | tojson | safe }};
const topCentersLabels = {{ top_centers | map(attribute=0) | list | tojson | safe }};
const topCentersData = {{ top_centers | map(attribute=1) | list | tojson | safe }};
const categoryDistLabels = {{ category_dist | map(attribute=0) | list | tojson | safe }};
const categoryDistData = {{ category_dist | map(attribute=1) | list | tojson | safe }};
const paidValue = {{ paid | round(2) }};
const outstandingValue = {{ outstanding | round(2) }};

// Monthly Billing Trend
const monthlyTrendCtx = document.getElementById('monthlyTrendChart').getContext('2d');
new Chart(monthlyTrendCtx, {
    type: 'line',
    data: {
        labels: monthlyTrendLabels,
        datasets: [{
            label: 'Revenue',
            data: monthlyTrendData,
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            fill: true,
            tension: 0.3
        }]
    },
    options: {responsive: true}
});
// Top 5 Centers
const topCentersCtx = document.getElementById('topCentersChart').getContext('2d');
new Chart(topCentersCtx, {
    type: 'bar',
    data: {
        labels: topCentersLabels,
        datasets: [{
            label: 'Revenue',
            data: topCentersData,
            backgroundColor: 'rgba(255, 99, 132, 0.6)'
        }]
    },
    options: {responsive: true}
});
// Category Distribution
const categoryDistCtx = document.getElementById('categoryDistChart').getContext('2d');
new Chart(categoryDistCtx, {
    type: 'doughnut',
    data: {
        labels: categoryDistLabels,
        datasets: [{
            label: 'Revenue',
            data: categoryDistData,
            backgroundColor: [
                'rgba(255, 99, 132, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(255, 206, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(153, 102, 255, 0.6)',
                'rgba(255, 159, 64, 0.6)'
            ]
        }]
    },
    options: {responsive: true}
});
// Paid vs Outstanding
const paidOutstandingCtx = document.getElementById('paidOutstandingChart').getContext('2d');
new Chart(paidOutstandingCtx, {
    type: 'pie',
    data: {
        labels: ['Paid', 'Outstanding'],
        datasets: [{
            data: [paidValue, outstandingValue],
            backgroundColor: [
                'rgba(40, 167, 69, 0.7)',
                'rgba(220, 53, 69, 0.7)'
            ]
        }]
    },
    options: {responsive: true}
});
</script>
{% endblock %}
